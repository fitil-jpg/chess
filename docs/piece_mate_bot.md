## PieceMateBot — «мат» фігурі (не королю)

**Ідея**: бот навмисно «матує» вибрані фігури суперника (крім короля), тобто позбавляє їх усіх безпечних відступів. Фігура вважається «заматованою», якщо її поточне поле під боєм і вона не має жодного безпечного ходу (включно з узяттями), який приземляється на клітину, що не перебуває під атакою нашої сторони. Семантика збігається з `is_piece_mated` у легковаговому оцінювачі.

### Коли це корисно
- **Обмежені просторово позиції**: у «закритих» структурах вигідно душити активність окремих фігур.
- **Локальні зв’язування**: замість загального виграшу матеріалу — примусово «вимикаємо» кілька ворожих фігур.
- **Конверсія переваги**: скутий суперник часто змушений послаблювати інші ділянки, що спрощує подальшу атаку чи перехід у вигідну для нас еншпільну позицію.

---

### Як бот мислить (коротко)
PieceMateBot оцінює кожен легальний хід за тим, наскільки він:
- **Збільшує кількість «заматованих» цільових фігур** — ключова мета.
- **Зменшує кількість безпечних втеч** для цих цілей.
- **Нарощує тиск** на цілі: різниця («наші атакуючі − їхні захисники») на полях цілей.
- Додає невелику **перевагу за шах**, **SEE** для взяттів і легкий **позиційний тай-брейк**.

Вибір цілей відбувається так:
- Якщо заданий `target_piece_type` — беремо всі ворожі фігури цього типу.
- Інакше — автоматично обираємо до `max_targets` «найтонших» ворожих фігур за `ThreatMap` (дефіцит оборони), з пріоритетом небійових (ферзь/тура/офіцер/кінь над пішаком).

---

### Публічний API
```python
from chess_ai.piece_mate_bot import PieceMateBot
import chess

bot = PieceMateBot(
    color=chess.WHITE,
    target_piece_type=None,  # наприклад, chess.KNIGHT, chess.BISHOP ...
    max_targets=3,           # скільки фігур одночасно «душити»
    safe_only=False,         # пропускати явно небезпечні ходи за простим гейтом
    weights=None,            # перевизначення ваг (див. нижче)
)

move, score = bot.choose_move(board, debug=True)
```

Параметри:
- **color**: колір бота (`chess.WHITE`/`chess.BLACK`).
- **target_piece_type**: необов’язково; обмежити цілі певним типом фігур (`chess.QUEEN`, `chess.ROOK`, `chess.BISHOP`, `chess.KNIGHT`, `chess.PAWN`).
- **max_targets**: скільки ворожих фігур тримати у фокусі одночасно.
- **safe_only**: якщо `True`, фільтрує ходи, що очевидно підставляються (за простим атакуючі/захисники і SEE для взяттів).
- **weights**: перевизначення ваг компонент оцінки.

Повертає: кортеж `(move, score)`, де `move` — вибраний хід або `None`, `score` — сирий оціночний бал.

---

### Ваги та дефолти
Ключі ваг та типові значення:
- **mate**: `800.0` — приріст кількості «заматованих» цільових фігур.
- **reduce_escape**: `15.0` — зменшення сумарних безпечних відступів.
- **pressure**: `2.5` — тиск на цілі (наші атакуючі − їхні захисники).
- **see**: `1.0` — SEE для взяттів (карає грубі підставляння матеріалу).
- **check**: `20.0` — бонус за шах, що часто зменшує свободу суперника глобально.
- **pos**: `0.1` — легкий позиційний тай-брейк через `Evaluator.position_score`.

Приклад тюнінгу:
```python
bot = PieceMateBot(
    color=chess.BLACK,
    max_targets=2,
    safe_only=True,
    weights={"mate": 1000.0, "reduce_escape": 20.0, "pressure": 3.0},
)
```

---

### Приклади використання
- **Базовий запуск**:
```python
import chess
from chess_ai.piece_mate_bot import PieceMateBot

board = chess.Board()
bot = PieceMateBot(chess.WHITE)
move, score = bot.choose_move(board, debug=True)
board.push(move)
```

- **Полювання на коней** (з більш консервативним відбором ходів):
```python
bot = PieceMateBot(
    color=chess.WHITE,
    target_piece_type=chess.KNIGHT,
    safe_only=True,
)
```

---

### Дизайн і обмеження
- Бот «дивиться у ширину», але **не проводить глибокий пошук**; це швидка, евристична стратегія.
- За відсутності адекватних цілей виконує **позиційний фолбек** (легковагове оцінювання позиції + невеликі бонуси за шах/SEE).
- `safe_only=True` допомагає уникати очевидних самопідстав, але може **пропускати тактичні ресурси**, які вимагали б глибшого рахунку.
- Найкращий ефект — у структурах, де втечі реально обмежувані (закриті, стиснені позиції).

---

### Взаємодія з іншими ботами
PieceMateBot природно **синергізує** з:
- критичними/тактичними сканерами загроз (щоб швидко знаходити «тонкі» фігури),
- оборонними підходами (закриття ліній і фіксація пішацьких ланцюгів),
- агресивними модулями (конвертація скутості у матеріал/атаку).

У поточному проєкті він доступний як окремий агент (`chess_ai.PieceMateBot`), його можна викликати безпосередньо або інтегрувати у власні ансамблі.

---

### Тестування
- Переконайтесь, що залежності встановлені (див. кореневий `README.md`).
- Запустіть короткий інтерактивний сценарій у Python (див. приклади вище) або додайте виклики у власний пайплайн.

Якщо потрібна інтеграція у ваш оркестратор/ансамбль — задайте конкретні вимоги (ваги, фільтри цілей), і бот можна легко під’єднати як ще одне джерело кандидатів із власним скорингом.
